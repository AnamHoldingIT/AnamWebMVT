{% extends "admin-panel/base_admin.html" %}
{% load static %}

{% block title %}جزئیات درخواست Recode{% endblock %}
{% block menu_recode %}active{% endblock %}

{% block content %}

<div class="detail-header">
    <div>
        <div class="page-title">
            درخواست Recode – {{ recode.full_name }}
        </div>
        <p class="detail-subtitle">
            ثبت شده در {{ recode.created_at|date:"Y/m/d H:i" }} · شماره تماس:
            <span class="dir-ltr">{{ recode.phone }}</span>
        </p>
    </div>

    <div class="detail-header-actions">
        <span class="detail-badge
            {% if recode.status == 'new' %}
                detail-badge-warning
            {% elif recode.status == 'accepted' %}
                detail-badge-success
            {% else %}
                detail-badge-info
            {% endif %}
        ">
            <i class="bi bi-circle-half"></i>
            وضعیت: {{ recode.get_status_display }}
        </span>

        <a href="{% url 'admin_panel:recode_list' %}" class="detail-back-btn">
            <i class="bi bi-arrow-right-short"></i>
            بازگشت به لیست
        </a>
    </div>
</div>

<div class="detail-card">

    <!-- اطلاعات اصلی -->
    <div class="detail-grid">

        <div class="detail-item">
            <span class="detail-label">نام و نام خانوادگی</span>
            <span class="detail-value">{{ recode.full_name }}</span>
        </div>

        <div class="detail-item">
            <span class="detail-label">شماره تماس</span>
            <span class="detail-value dir-ltr">{{ recode.phone }}</span>
        </div>

        <div class="detail-item">
            <span class="detail-label">وضعیت فعلی</span>
            <span class="detail-value">
                {{ recode.get_status_display }}
            </span>
        </div>

        <div class="detail-item">
            <span class="detail-label">تاریخ ثبت</span>
            <span class="detail-value">
                {{ recode.created_at|date:"Y/m/d H:i" }}
            </span>
        </div>

        <div class="detail-item">
            <span class="detail-label">آخرین بروزرسانی</span>
            <span class="detail-value">
                {{ recode.updated_at|date:"Y/m/d H:i" }}
            </span>
        </div>

    </div>

    <!-- فرم ویرایش وضعیت و یادداشت داخلی -->
    <form method="post" class="mt-3">
        {% csrf_token %}

        <div class="row g-3">

            <div class="col-md-4">
                <label class="detail-label d-block mb-1">تغییر وضعیت</label>
                <select name="status" class="form-select form-select-sm custom-input">
                    {% for value, label in status_choices %}
                        <option class="text-white bg-dark-form" value="{{ value }}" {% if recode.status == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-12">
                <div class="detail-description">
                    <div class="detail-description-header">
                        <i class="bi bi-journal-text me-1"></i>
                        یادداشت داخلی تیم آنام
                    </div>
                    <textarea
                            name="notes"
                            rows="4"
                            class="form-control custom-input"
                            style="background: transparent; border: 1px solid rgba(255,255,255,0.1); color: #f8fbfa;"
                    >{{ recode.notes }}</textarea>
                </div>
            </div>

            <div class="col-12 text-start mt-1">
                <button type="submit" class="btn btn-warning btn-sm px-4">
                    <i class="bi bi-save me-1"></i>
                    ذخیره تغییرات
                </button>
            </div>

        </div>
    </form>

</div>

{% endblock %}
